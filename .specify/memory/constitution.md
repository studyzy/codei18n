<!--
同步影响报告 - 章程更新 v1.0.0
生成时间: 2025-12-15

版本更改: 初始版本 → 1.0.0

修改的原则列表:
  - 新增: I. AST 优先原则
  - 新增: II. 单一语言源原则
  - 新增: III. 代码规范与测试
  - 新增: IV. 中文优先
  - 新增: V. CLI 优先

添加的部分:
  - 技术约束
  - 质量标准

删除的部分:
  - 无

需要更新的模板:
  ✅ .specify/templates/plan-template.md - 已更新章程检查部分
  ✅ .specify/templates/spec-template.md - 验收标准与质量门槛对齐
  ✅ .specify/templates/tasks-template.md - 测试任务要求对齐

后续 TODO:
  - 无

递增理由: MAJOR 版本 - 初始章程创建，建立项目核心治理原则
-->

# CodeI18n 项目章程

## 核心原则

### I. AST 优先原则

所有注释解析、提取和处理**必须**基于抽象语法树（AST）实现，**禁止**使用以下方式：
- 基于行号的注释定位
- 正则表达式提取注释
- 字符串匹配方式处理注释

**理由**: AST 保证注释与代码语义的稳定绑定，确保在代码重构时注释映射不会失效。这是整个项目的技术基石。

**实施要求**:
- Go 语言使用 `go/parser` 和 `go/ast` 标准库
- Rust 语言使用 `syn` crate 或 tree-sitter
- 其他语言统一使用 tree-sitter 适配器
- 注释必须绑定到具体的语义符号（函数、结构体、模块等）

### II. 单一语言源原则

Git 仓库中**必须**只存储一种注释语言（推荐英文），本地多语言注释通过映射文件实现。

**理由**: 避免 Git 历史污染，确保 diff/blame 的可读性，维护代码库的一致性。

**实施要求**:
- 源码仓库注释语言为英文
- `.codei18n/` 目录存储本地映射文件
- 映射文件默认不提交到 Git（通过 .gitignore 排除）
- pre-commit hook 自动将非英文注释转换为英文
- 所有注释翻译必须可逆且可定位

### III. 代码规范与测试

本项目**必须**遵循以下开发标准：

**Go 代码规范**:
- 严格遵循 [Effective Go](https://go.dev/doc/effective_go) 规范
- 使用 `gofmt` 格式化所有代码
- 使用 `golint` 或 `staticcheck` 进行代码检查
- 遵循 Go 命名约定（驼峰命名、包名小写等）

**单元测试要求**:
- 单元测试覆盖率**必须**达到 60% 以上
- 核心模块（comment、mapping、translate）覆盖率**必须**达到 80% 以上
- 每个公共函数和方法都应有对应的测试用例
- 使用表驱动测试（table-driven tests）处理多场景
- 测试文件命名为 `*_test.go`

**集成测试要求**:
- AST 解析器必须有完整的集成测试
- Git hook 工作流必须有端到端测试
- CLI 命令必须有集成测试验证输入输出

**理由**: 代码质量和测试覆盖率是项目长期维护性的保证，60% 的覆盖率是最低可接受标准。

### IV. 中文优先

本项目所有文档和代码注释**必须**使用中文。

**实施要求**:
- 所有 Markdown 文档（README、设计文档、API 文档等）使用中文
- Go 代码中所有注释使用中文
- 函数、类型、变量的命名使用英文（符合 Go 规范）
- 错误信息和日志可以使用中文（用户友好）或英文（国际化考虑）
- Git commit message 使用中文
- 代码示例和测试用例的注释使用中文

**理由**: 本项目为中国开发者服务，中文注释和文档可以降低理解门槛，提高协作效率。这与项目本身的国际化目标不冲突——项目处理的是源码注释的多语言问题，而非项目自身文档的语言。

### V. CLI 优先

核心功能**必须**通过 CLI 暴露，IDE 插件仅作为渲染层。

**实施要求**:
- CLI 提供完整的注释扫描、翻译、映射管理功能
- CLI 输出支持 JSON 和人类可读格式
- IDE 插件通过调用 CLI 获取数据，不包含业务逻辑
- 输入输出协议：stdin/args → stdout，错误 → stderr
- CLI 必须支持管道操作和脚本集成

**理由**: Core 与 IDE 解耦，确保功能可独立测试、独立使用，降低 IDE 插件的实现复杂度。

## 技术约束

### 项目范围

**本仓库职责**:
- CodeI18n Core 核心引擎（Go 实现）
- CLI 工具
- AST 适配器（Go、Rust、Tree-sitter）
- Git hook 集成
- 核心文档和使用指南

**不包含**:
- VS Code 扩展（独立仓库）
- JetBrains 插件（独立仓库）
- IDE 特定的渲染逻辑

### 依赖管理

- 使用 Go Modules 管理依赖
- 最小化第三方依赖，优先使用标准库
- 翻译引擎支持插拔式后端（DeepL、OpenAI、自定义）
- 避免引入重量级框架

### 性能要求

- 单文件注释扫描时间 < 100ms（Go 文件 < 1000 行）
- 支持增量扫描（仅处理变更文件）
- 映射文件加载时间 < 50ms（< 10000 条映射）
- pre-commit hook 处理时间 < 5s（< 50 个文件）

## 质量标准

### 代码质量

- 所有公共 API 必须有 GoDoc 注释
- 复杂逻辑（圈复杂度 > 10）必须有详细注释说明
- 避免全局变量，使用依赖注入
- 错误处理必须明确，不允许 `panic` 在库代码中
- 使用 context.Context 处理超时和取消

### 文档质量

- README.md 必须包含：项目介绍、快速开始、核心概念、使用示例
- 每个包必须有 package doc 说明职责和用法
- 复杂算法（如注释 ID 生成）必须有详细设计文档
- API 变更必须更新 CHANGELOG.md

### 版本控制

遵循语义化版本控制（Semantic Versioning）:
- **MAJOR**: 破坏性变更（API 不兼容、映射文件格式变更）
- **MINOR**: 新功能添加（新语言支持、新 CLI 命令）
- **PATCH**: Bug 修复和优化

## 治理

### 章程优先级

本章程优先于所有其他实践和约定。所有代码提交、设计决策、代码审查必须验证是否符合章程要求。

### 修正流程

章程修正需要：
1. 在 issue 中提出修正提案，说明理由和影响范围
2. 团队评审和讨论（至少 3 个工作日）
3. 更新章程版本号（按语义版本规则）
4. 同步更新所有依赖模板和文档
5. 记录修正历史和迁移计划

### 合规验证

- 所有 Pull Request 必须通过 CI 检查：代码规范、测试覆盖率
- 代码审查必须验证：AST 使用、单一语言源、中文注释
- 复杂度检查：违反简洁性原则的设计必须在 PR 中提供充分理由

### 指导文件

- 运行时开发指导：`CODEBUDDY.md`（CodeBuddy Code 专用）
- 技术设计文档：`README.md`
- API 文档：各包的 GoDoc
- 用户指南：`docs/` 目录

**版本**: 1.0.0 | **批准日期**: 2025-12-15 | **最后修正**: 2025-12-15
